// BladeTweaks by @blade1981m was a big inspiration for MunksFixes, my first ever 'mod'
// so i wanted to go back and pick out the best parts from that mod for this patch
// a lot of what was in BladeTweaks is now a part of this mod and MunksFixes

// ============================================================================

// first up: removing srf attach from conical (cone-shaped) parts
// this is because it doesn't make sense to try to attach a cone
// it won't stick to the part in a way that makes sense
// doesn't affect slanted cones

//@PART[pointyNoseConeA]:FOR[SuperfluousNodesRenoded]
//{
//	!node_attach = DELETE
//	@attachRules = 1,0,1,1,1
//	@bulkheadProfiles = size1
//	@tags ^= :$: ?superfluous:
//}

//@PART[airplaneTail]:FOR[SuperfluousNodesRenoded]
//{
//	!node_attach = DELETE
//	@attachRules = 1,0,1,1,1
//	@bulkheadProfiles = size1
//	@tags ^= :$: ?superfluous:
//}

/@PART[adapterSize2-Size1]:FOR[SuperfluousNodesRenoded]
//{
//	!node_attach = DELETE
//	@attachRules = 1,0,1,1,1
//	@bulkheadProfiles = size2, size1
//	@tags ^= :$: ?superfluous:
//}

// next: the actual blade tweaks from 'Blade Tweaks'

// Removing allow surface attach from rotors/rotor engines so blades mount at connection points only
@PART[rotor_0*]:NEEDS[SquadExpansion/Serenity]:FOR[SuperfluousNodesRenoded]
{	
	@attachRules = 1,1,1,0,1
	@tags ^= :$: ?superfluous:
}
@PART[RotorEngine_0*]:NEEDS[SquadExpansion/Serenity]:FOR[SuperfluousNodesRenoded]
{	
	@attachRules = 1,1,1,0,1
	@tags ^= :$: ?superfluous:
}

// Switch fan blades, propellers, and helicopter blades to stack mount instead of surface mount to work with rotor connection points
@PART[*FanBlade]:NEEDS[SquadExpansion/Serenity]:FOR[SuperfluousNodesRenoded]
{	
	@attachRules = 1,0,0,0,1
	@tags ^= :$: ?superfluous:
}
@PART[*Propeller]:NEEDS[SquadExpansion/Serenity]:FOR[SuperfluousNodesRenoded]
{	
	@attachRules = 1,0,0,0,1
	@tags ^= :$: ?superfluous:
}
@PART[*HeliBlade]:NEEDS[SquadExpansion/Serenity]:FOR[SuperfluousNodesRenoded]
{	
	@attachRules = 1,0,0,0,1
	@tags ^= :$: ?superfluous:
}

// ============================================================================

// inline rcs tanks: can now be attached radially! just like normal fuel tanks!
@PART[RCSFuelTank]:FOR[SuperfluousNodesRenoded]
{
	node_attach = 0.625, 0.0, 0.0, 1, 0, 0, 1
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size1, srf
	@tags ^= :$: ?superfluous:
}

@PART[RCSTank1-2]:FOR[SuperfluousNodesRenoded]
{
	node_attach = 1.25, 0.0, 0.0, 1, 0, 0, 2
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size2, srf
	@tags ^= :$: ?superfluous:
}

@PART[Size1p5_Monoprop]:NEEDS[SquadExpansion/MakingHistory]:FOR[SuperfluousNodesRenoded]
{
	node_attach = 0.9375, 0.0, 0.0, 1, 0, 0, 2
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size1p5, srf
	@tags ^= :$: ?superfluous:
}

// xenon tanks: also can now be attached radially! also just like normal fuel tanks!
@PART[xenonTank]:FOR[SuperfluousNodesRenoded]
{
	node_attach = 0.25, 0.0, 0.0, 1, 0, 0, 0
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size0, srf
	@tags ^= :$: ?superfluous:
}

@PART[xenonTankLarge]:FOR[SuperfluousNodesRenoded]
{
	node_attach = 0.625, 0.0, 0.0, 1, 0, 0, 1
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size1, srf
	@tags ^= :$: ?superfluous:
}

// ============================================================================

// remove surface attach from these size4 parts (why Squad did you even give them surface attach???)
// no other adapter tank can srf attch... and the engine mount? IT DOESN'T EVEN HAVE NODE_ATTACH SQUAD WHY
@PART[Size3_Size4_Adapter_01]:NEEDS[SquadExpansion/MakingHistory]:FOR[SuperfluousNodesRenoded]
{
	!node_attach = DELETE
	@attachRules = 1,0,1,1,1
	@bulkheadProfiles = size4, size3
	@tags ^= :$: ?superfluous:
}

@PART[Size4_EngineAdapter_01]:NEEDS[SquadExpansion/MakingHistory]:FOR[SuperfluousNodesRenoded]
{
	@attachRules = 1,0,1,1,1
	@bulkheadProfiles = size4, size1
	@tags ^= :$: ?superfluous:
}

// ============================================================================

// restore radial attachment (they have node_attach defined!)
//@PART[batteryBankMini]:FOR[SuperfluousNodesRenoded]
//{
//	@node_attach = 0.3125, 0.0, 0.0, 1, 0, 0, 0
//	@attachRules = 1,1,1,1,1
//	@bulkheadProfiles = size0, srf
//	@tags ^= :$: ?superfluous:
//}

//@PART[parachuteSingle]:FOR[SuperfluousNodesRenoded]
//{
//	@attachRules = 1,1,0,1,1
//	@bulkheadProfiles = size0, srf
//	@tags ^= :$: ?superfluous:
//}

//@PART[parachuteLarge]:FOR[SuperfluousNodesRenoded]
//{
//	@attachRules = 1,1,0,1,1
//	@bulkheadProfiles = size1, srf
//	@tags ^= :$: ?superfluous:
//}

//@PART[parachuteDrogue]:FOR[SuperfluousNodesRenoded]
//{
//	@attachRules = 1,1,0,1,1
//	@bulkheadProfiles = size1, srf
//	@tags ^= :$: ?superfluous:
//}

// ============================================================================

// fix the node_attach on the mk2 crew cabin (it's broken)
@PART[mk2CrewCabin]:FOR[SuperfluousNodesRenoded]
{
	@node_attach = 1.25, 0.0, 0.0, 1, 0, 0, 1
	@attachRules = 1,1,1,1,1
	@tags ^= :$: ?superfluous:
}

// ============================================================================

// remove srf attach from these parts (they're missing node_attach - probably not intended)
@PART[ISRU]:FOR[SuperfluousNodesRenoded]
{
	@attachRules = 1,0,1,0,1
	@bulkheadProfiles = size2
	@tags ^= :$: ?superfluous:
}

@PART[LaunchEscapeSystem]:FOR[SuperfluousNodesRenoded]
{
	@attachRules = 1,0,1,1,1
	@bulkheadProfiles = size1
	@tags ^= :$: ?superfluous:
}

@PART[Size1p5_Strut_Decoupler]:NEEDS[SquadExpansion/MakingHistory]:FOR[SuperfluousNodesRenoded]
{
	@attachRules = 1,0,1,1,1
	@bulkheadProfiles = size1p5
	@tags ^= :$: ?superfluous:
}