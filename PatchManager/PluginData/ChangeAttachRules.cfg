// BladeTweaks by @blade1981m was a big inspiration for MunksFixes, my first ever 'mod'
// so I wanted to go back and pick out the best parts from that mod for this patch
// a lot of what was in BladeTweaks is now a part of this mod and MunksFixes

// ============================================================================

// first up: removing srf attach from conical (cone-shaped), non-slanted cone parts
// this is because it doesn't make sense to try to attach a cone - it won't stick to the part in a way that makes sense
// disabling this code for now - uncomment to make these parts stack only
//@PART[pointyNoseConeA]:LAST[SuperfluousNodesRenoded]
//{
//	!node_attach = DELETE
//	@attachRules = 1,0,1,1,1
//	@bulkheadProfiles = size1
//	@tags ^= :$: ?superfluous:
//	enableSuperfluousNodes = true
//}

//@PART[airplaneTail]:LAST[SuperfluousNodesRenoded]
//{
//	!node_attach = DELETE
//	@attachRules = 1,0,1,1,1
//	@bulkheadProfiles = size1
//	@tags ^= :$: ?superfluous:
//	enableSuperfluousNodes = true
//}

/@PART[adapterSize2-Size1]:LAST[SuperfluousNodesRenoded]
//{
//	!node_attach = DELETE
//	@attachRules = 1,0,1,1,1
//	@bulkheadProfiles = size2, size1
//	@tags ^= :$: ?superfluous:
//	enableSuperfluousNodes = true
//}

// next up: the actual blade tweaks from 'Blade Tweaks'
// Switch fan blades, propellers, and helicopter blades to stack mount instead of surface mount to work with rotor connection points
@PART[smallFanBlade|mediumFanBlade|largeFanBlade]:NEEDS[SquadExpansion/Serenity]:LAST[SuperfluousNodesRenoded]
{	
	@attachRules = 1,0,0,0,1
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}
@PART[smallPropeller|mediumPropeller|largePropeller]:NEEDS[SquadExpansion/Serenity]:LAST[SuperfluousNodesRenoded]
{	
	@attachRules = 1,0,0,0,1
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}
@PART[smallHeliBlade|mediumHeliBlade|largeHeliBlade]:NEEDS[SquadExpansion/Serenity]:LAST[SuperfluousNodesRenoded]
{	
	@attachRules = 1,0,0,0,1
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

// ============================================================================

// inline RCS tanks: can now be attached radially! just like normal fuel tanks! wow!
// it was always weird to me how they were stack-only parts, while normal tanks could be surface attached
@PART[RCSFuelTank]:LAST[SuperfluousNodesRenoded]
{
	%node_attach = 0.625, 0.0, 0.0, 1, 0, 0, 1
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size1, srf
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

@PART[RCSTank1-2]:LAST[SuperfluousNodesRenoded]
{
	%node_attach = 1.25, 0.0, 0.0, 1, 0, 0, 2
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size2, srf
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

@PART[Size1p5_Monoprop]:NEEDS[SquadExpansion/MakingHistory]:LAST[SuperfluousNodesRenoded]
{
	%node_attach = 0.9375, 0.0, 0.0, 1, 0, 0, 2
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size1p5, srf
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

// xenon tanks: also can now be attached radially! also just like normal fuel tanks! also wow!
@PART[xenonTank]:LAST[SuperfluousNodesRenoded]
{
	%node_attach = 0.3125, 0.0, 0.0, 1, 0, 0, 0
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size0, srf
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

@PART[xenonTankLarge]:LAST[SuperfluousNodesRenoded]
{
	%node_attach = 0.625, 0.0, 0.0, 1, 0, 0, 1
	@attachRules = 1,1,1,1,1
	@bulkheadProfiles = size1, srf
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

// ============================================================================

// remove srf attach ability from these parts (missing node_attach - probably not intended)
@PART[ISRU]:LAST[SuperfluousNodesRenoded]
{
	@attachRules = 1,0,1,0,1
	@bulkheadProfiles = size2
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

@PART[LaunchEscapeSystem]:LAST[SuperfluousNodesRenoded]
{
	@attachRules = 1,0,1,1,1
	@bulkheadProfiles = size1
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

@PART[Size1p5_Strut_Decoupler]:NEEDS[SquadExpansion/MakingHistory]:LAST[SuperfluousNodesRenoded]
{
	@attachRules = 1,0,1,1,1
	@bulkheadProfiles = size1p5
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

// ============================================================================

// remove surface attach from these size4 parts (why Squad did you even give them surface attach???)
// no other adapter tank can srf attach anyways... and the engine mount? IT DOESN'T EVEN HAVE NODE_ATTACH SQUAD. I'M GOING INSANE
@PART[Size3_Size4_Adapter_01]:NEEDS[SquadExpansion/MakingHistory]:LAST[SuperfluousNodesRenoded]
{
	!node_attach = DELETE
	@attachRules = 1,0,1,1,1
	@bulkheadProfiles = size4, size3
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

@PART[Size4_EngineAdapter_01]:NEEDS[SquadExpansion/MakingHistory]:LAST[SuperfluousNodesRenoded]
{
	@attachRules = 1,0,1,1,1
	@bulkheadProfiles = size4, size1
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

// ============================================================================

// fix node_attach on these parts (they're broken)
@PART[miniFuelTank]:LAST[SuperfluousNodesRenoded]
{
	@node_attach = 0.3125, 0.0, 0.0, 1, 0, 0, 0
	@attachRules = 1,1,1,1,1
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

@PART[rcsTankMini]:LAST[SuperfluousNodesRenoded]
{
	@node_attach = 0.3125, 0.0, 0.0, 1, 0, 0, 0
	@attachRules = 1,1,1,1,1
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

@PART[mk2CrewCabin]:LAST[SuperfluousNodesRenoded]
{
	@node_attach = 1.25, 0.0, 0.0, 1, 0, 0, 2
	@attachRules = 1,1,1,1,1
	@tags ^= :$: ?superfluous:
	enableSuperfluousNodes = true
}

@PART[batteryBankMini]:LAST[SuperfluousNodesRenoded]
{	@node_attach = 0.3125, 0.0, 0.0, 1, 0, 0, 0	}

// ============================================================================

// restore radial attachment (node_attach is defined in the part .cfg)
// disabling this code for now - uncomment to make these parts srf attach
//@PART[batteryBankMini]:LAST[SuperfluousNodesRenoded]
//{
//	@attachRules = 1,1,1,1,1
//	@bulkheadProfiles = size0, srf
//	@tags ^= :$: ?superfluous:
//	enableSuperfluousNodes = true
//}

//@PART[parachuteSingle]:LAST[SuperfluousNodesRenoded]
//{
//	@attachRules = 1,1,0,1,1
//	@bulkheadProfiles = size0, srf
//	@tags ^= :$: ?superfluous:
//	enableSuperfluousNodes = true
//}

//@PART[parachuteLarge]:LAST[SuperfluousNodesRenoded]
//{
//	@attachRules = 1,1,0,1,1
//	@bulkheadProfiles = size1, srf
//	@tags ^= :$: ?superfluous:
//	enableSuperfluousNodes = true
//}

//@PART[parachuteDrogue]:LAST[SuperfluousNodesRenoded]
//{
//	@attachRules = 1,1,0,1,1
//	@bulkheadProfiles = size1, srf
//	@tags ^= :$: ?superfluous:
//	enableSuperfluousNodes = true
//}
